<!doctype html><html lang="en"><head>
<meta charset="utf-8"><title>Admin — SmartFlow Systems (No Backend)</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="icon" href="assets/favicon.svg"><link rel="stylesheet" href="styles.css">
<style>
  .wrap{max-width:980px;margin:24px auto;padding:0 16px}
  textarea,input,select{width:100%;padding:10px;border-radius:8px;border:1px solid #2d241e;background:#0f0c0a;color:#e9e6e1}
  label{display:block;margin:10px 0 6px}
  .grid2{display:grid;grid-template-columns:1fr;gap:16px}@media(min-width:860px){.grid2{grid-template-columns:1fr 1fr}}
  .note{color:#cbbf9b}
</style>
</head><body>
<header class="nav"><div class="brand"><img class="logo" src="assets/smartflow-logo.png"><span>SmartFlow Admin</span></div>
<nav><a href="index.html#projects">Site</a></nav></header>
<main class="wrap">
  <h1 class="section-title">Admin (Draft & Export)</h1>
  <p class="section-sub">This page stores drafts in your browser. Click "Export Files" to download Markdown/JSON you can commit to the repo.</p>

  <section class="card" style="padding:16px">
    <h2>New Blog Post</h2>
    <div class="grid2">
      <div>
        <label>Title<input id="p-title" placeholder="Post title"></label>
        <label>Date<input id="p-date" placeholder="YYYY-MM-DD"></label>
        <label>Tags (comma)<input id="p-tags" placeholder="ai,social"></label>
      </div>
      <div>
        <label>Body (Markdown)<textarea id="p-body" rows="10" placeholder="Write in Markdown…"></textarea></label>
      </div>
    </div>
    <button class="btn btn-primary" id="save-post">Save Draft</button>
  </section>

  <section class="card" style="padding:16px;margin-top:16px">
    <h2>New Update</h2>
    <div class="grid2">
      <div>
        <label>Title<input id="u-title" placeholder="Update title"></label>
        <label>Date<input id="u-date" placeholder="YYYY-MM-DD"></label>
        <label>Tags (comma)<input id="u-tags" placeholder="site,release"></label>
      </div>
      <div>
        <label>Body (Markdown)<textarea id="u-body" rows="8" placeholder="Changes…"></textarea></label>
      </div>
    </div>
    <button class="btn btn-primary" id="save-upd">Save Draft</button>
  </section>

  <section class="card" style="padding:16px;margin-top:16px">
    <h2>Export Files</h2>
    <p class="note">Exports: <code>/content/posts/{slug}.md</code> and <code>/content/updates/{date}-{slug}.md</code>. Commit and push, the site rebuilds.</p>
    <button class="btn btn-primary" id="export">Export ZIP</button>
  </section>
</main>
<footer class="footer"><div>© <span id="year"></span> SmartFlow Systems</div></footer>

<script>
  const drafts = JSON.parse(localStorage.getItem('sfs_drafts')||'{"posts":[],"updates":[]}');
  const save = ()=>localStorage.setItem('sfs_drafts', JSON.stringify(drafts));
  const slug = s=>String(s||'').toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'');

  document.getElementById('save-post').onclick = ()=>{
    const t = document.getElementById('p-title').value.trim(), d = document.getElementById('p-date').value.trim()||new Date().toISOString().slice(0,10), tg = document.getElementById('p-tags').value.trim(), b = document.getElementById('p-body').value.trim();
    if(!t||!b) return alert('Title and body required.');
    drafts.posts.push({title:t,date:d,tags:tg,body:b}); save(); alert('Draft post saved.');
  };
  document.getElementById('save-upd').onclick = ()=>{
    const t = document.getElementById('u-title').value.trim(), d = document.getElementById('u-date').value.trim()||new Date().toISOString().slice(0,10), tg = document.getElementById('u-tags').value.trim(), b = document.getElementById('u-body').value.trim();
    if(!t||!b) return alert('Title and body required.');
    drafts.updates.push({title:t,date:d,tags:tg,body:b}); save(); alert('Draft update saved.');
  };

  // Export as ZIP (minimal)
  document.getElementById('export').onclick = async ()=>{
    const files = [];
    drafts.posts.forEach(p=>{
      const fm = `---\\ntitle: ${p.title}\\ndate: ${p.date}\\ntags: ${p.tags}\\n---\\n`;
      files.push({path:`content/posts/${slug(p.title)}.md`, content: fm + p.body + "\\n"});
    });
    drafts.updates.forEach(u=>{
      const fm = `---\\ntitle: ${u.title}\\ndate: ${u.date}\\ntags: ${u.tags}\\n---\\n`;
      files.push({path:`content/updates/${u.date}-${slug(u.title)}.md`, content: fm + u.body + "\\n"});
    });
    // Build a basic ZIP by hand (store only)
    const tz = [];
    let offset = 0, fileRecs = [];
    const enc = new TextEncoder();
    function crc32(str){ // tiny CRC32
      let c = ~0; for (let i=0;i<str.length;i++){ c = (c>>>8) ^ [0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049][(c ^ str.charCodeAt(i)) & 15]; }
      return ~c >>> 0;
    }
    for(const f of files){
      const data = enc.encode(f.content);
      const name = enc.encode(f.path);
      const crc = crc32(f.content);
      const lfh = new Uint8Array(30 + name.length);
      const dv = new DataView(lfh.buffer);
      dv.setUint32(0, 0x04034b50, true); // local file header
      dv.setUint16(4, 20, true); // version
      dv.setUint16(6, 0, true); // flags
      dv.setUint16(8, 0, true); // no compression
      dv.setUint16(10, 0, true); dv.setUint16(12, 0, true); // time/date
      dv.setUint32(14, crc, true);
      dv.setUint32(18, data.length, true);
      dv.setUint32(22, data.length, true);
      dv.setUint16(26, name.length, true);
      dv.setUint16(28, 0, true);
      lfh.set(name, 30);
      tz.push(lfh, data);
      fileRecs.push({name, crc, size: data.length, offset});
      offset += lfh.length + data.length;
    }
    const cd = [];
    let cdlen = 0;
    for(const r of fileRecs){
      const rec = new Uint8Array(46 + r.name.length);
      const dv = new DataView(rec.buffer);
      dv.setUint32(0, 0x02014b50, true);
      dv.setUint16(4, 20, true); dv.setUint16(6, 20, true);
      dv.setUint16(8, 0, true); dv.setUint16(10, 0, true);
      dv.setUint16(12, 0, true); dv.setUint16(14, 0, true); dv.setUint16(16, 0, true);
      dv.setUint32(16+2, r.crc, true);
      dv.setUint32(24, r.size, true); dv.setUint32(28, r.size, true);
      dv.setUint16(32, r.name.length, true); dv.setUint16(34, 0, true); dv.setUint16(36, 0, true);
      dv.setUint16(38, 0, true); dv.setUint16(40, 0, true); dv.setUint32(42, 0, true);
      dv.setUint32(46-4, r.offset, true);
      rec.set(r.name, 46);
      cd.push(rec); cdlen += rec.length;
    }
    const eocd = new Uint8Array(22);
    const dv2 = new DataView(eocd.buffer);
    dv2.setUint32(0, 0x06054b50, true);
    dv2.setUint16(8, fileRecs.length, true);
    dv2.setUint16(10, fileRecs.length, true);
    dv2.setUint32(12, cdlen, true);
    dv2.setUint32(16, offset, true);
    const blob = new Blob([...tz, ...cd, eocd], {type:"application/zip"});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = "sfs-content.zip";
    a.click();
  };
  document.getElementById('year').textContent = new Date().getFullYear();
</script>
</body></html>